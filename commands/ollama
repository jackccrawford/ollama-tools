#!/bin/bash

# Wrapper script for Docker-based Ollama
# Default to the first Ollama instance
OLLAMA_CONTAINER="git-ollama0-1"

# Check if OLLAMA_INSTANCE environment variable is set (0, 1, 2, or 3)
if [[ -n "$OLLAMA_INSTANCE" ]]; then
  case "$OLLAMA_INSTANCE" in
    0) OLLAMA_CONTAINER="git-ollama0-1" ;;
    1) OLLAMA_CONTAINER="git-ollama1-1" ;;
    2) OLLAMA_CONTAINER="git-ollama2-1" ;;
    3) OLLAMA_CONTAINER="git-ollama3-1" ;;
    *) echo "Warning: OLLAMA_INSTANCE must be 0-3, using default (0)" >&2
       OLLAMA_CONTAINER="git-ollama0-1" ;;
  esac
fi

# If no arguments are provided, show help
if [[ $# -eq 0 ]]; then
  echo "Ollama wrapper script for Docker containers"
  echo "Usage: ollama COMMAND [ARGS...]"
  echo ""
  echo "Examples:"
  echo "  ollama list                       # List models in the default container"
  echo "  OLLAMA_INSTANCE=1 ollama list     # List models in a specific container"
  exit 0
fi

# Special handling for interactive 'run' command
if [[ "$1" == "run" && $# -eq 2 ]]; then
  # This is an interactive run with just the model name
  echo "Starting interactive session with $2 on instance ${OLLAMA_INSTANCE:-0}"
  docker exec -it $OLLAMA_CONTAINER ollama "$@"
  exit $?
fi

# Execute the command in the Docker container
docker exec -i $OLLAMA_CONTAINER ollama "$@"
